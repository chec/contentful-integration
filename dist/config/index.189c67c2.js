/**
  postmate - A powerful, simple, promise-based postMessage library
  @version v1.5.2
  @link https://github.com/dollarshaveclub/postmate
  @author Jacob Kelley <jakie8@gmail.com>
  @license MIT
**/
var e=0,t={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},n=function(e,n){return("string"!=typeof n||e.origin===n)&&(!!e.data&&(("object"!=typeof e.data||"postmate"in e.data)&&("application/x-postmate-v1+json"===e.data.type&&!!t[e.data.postmate])))},a=function(){function t(e){var t=this;this.parent=e.parent,this.frame=e.frame,this.child=e.child,this.childOrigin=e.childOrigin,this.events={},this.listener=function(e){if(!n(e,t.childOrigin))return!1;var a=((e||{}).data||{}).value||{},i=a.data,s=a.name;"emit"===e.data.postmate&&s in t.events&&t.events[s].call(t,i)},this.parent.addEventListener("message",this.listener,!1)}var a=t.prototype;return a.get=function(t){var n=this;return new s.Promise((function(a){var i=++e;n.parent.addEventListener("message",(function e(t){t.data.uid===i&&"reply"===t.data.postmate&&(n.parent.removeEventListener("message",e,!1),a(t.data.value))}),!1),n.child.postMessage({postmate:"request",type:"application/x-postmate-v1+json",property:t,uid:i},n.childOrigin)}))},a.call=function(e,t){this.child.postMessage({postmate:"call",type:"application/x-postmate-v1+json",property:e,data:t},this.childOrigin)},a.on=function(e,t){this.events[e]=t},a.destroy=function(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)},t}(),i=function(){function e(e){var t=this;this.model=e.model,this.parent=e.parent,this.parentOrigin=e.parentOrigin,this.child=e.child,this.child.addEventListener("message",(function(e){if(n(e,t.parentOrigin)){var a=e.data,i=a.property,o=a.uid,r=a.data;"call"!==e.data.postmate?function(e,t){var n="function"==typeof e[t]?e[t]():e[t];return s.Promise.resolve(n)}(t.model,i).then((function(t){return e.source.postMessage({property:i,postmate:"reply",type:"application/x-postmate-v1+json",uid:o,value:t},e.origin)})):i in t.model&&"function"==typeof t.model[i]&&t.model[i](r)}}))}return e.prototype.emit=function(e,t){this.parent.postMessage({postmate:"emit",type:"application/x-postmate-v1+json",value:{name:e,data:t}},this.parentOrigin)},e}(),s=function(){function e(e){var t=e.container,n=void 0===t?void 0!==n?n:document.body:t,a=e.model,i=e.url,s=e.name,o=e.classListArray,r=void 0===o?[]:o;return this.parent=window,this.frame=document.createElement("iframe"),this.frame.name=s||"",this.frame.classList.add.apply(this.frame.classList,r),n.appendChild(this.frame),this.child=this.frame.contentWindow||this.frame.contentDocument.parentWindow,this.model=a||{},this.sendHandshake(i)}return e.prototype.sendHandshake=function(t){var i,s=this,o=function(e){var t=document.createElement("a");t.href=e;var n=t.protocol.length>4?t.protocol:window.location.protocol,a=t.host.length?"80"===t.port||"443"===t.port?t.hostname:t.host:window.location.host;return t.origin||n+"//"+a}(t),r=0;return new e.Promise((function(e,c){s.parent.addEventListener("message",(function t(r){return!!n(r,o)&&("handshake-reply"===r.data.postmate?(clearInterval(i),s.parent.removeEventListener("message",t,!1),s.childOrigin=r.origin,e(new a(s))):c("Failed handshake"))}),!1);var d=function(){r++,s.child.postMessage({postmate:"handshake",type:"application/x-postmate-v1+json",model:s.model},o),5===r&&clearInterval(i)},h=function(){d(),i=setInterval(d,500)};s.frame.attachEvent?s.frame.attachEvent("onload",h):s.frame.onload=h,s.frame.src=t}))},e}();s.debug=!1,s.Promise=function(){try{return window?window.Promise:Promise}catch(e){return null}}(),s.Model=function(){function e(e){return this.child=window,this.model=e,this.parent=this.child.parent,this.sendHandshakeReply()}return e.prototype.sendHandshakeReply=function(){var e=this;return new s.Promise((function(t,n){e.child.addEventListener("message",(function a(s){if(s.data.postmate){if("handshake"===s.data.postmate){e.child.removeEventListener("message",a,!1),s.source.postMessage({postmate:"handshake-reply",type:"application/x-postmate-v1+json"},s.origin),e.parentOrigin=s.origin;var o=s.data.model;return o&&Object.keys(o).forEach((function(t){e.model[t]=o[t]})),t(new i(e))}return n("Handshake Reply Failed")}}),!1)}))},e}();var o=s;class r{constructor(){this.handlers=[]}pushHandler(e){this.handlers.push(e)}trigger(e){this.handlers.forEach((t=>t(e)))}}class c{constructor(e,t){this.parent=e,this.eventBus=t,this.config=e.model.config||{},this.configWatchers=[],this.eventBus.pushHandler((e=>{"set-config"===e.event&&(this.config=e.payload,this.configWatchers.forEach((e=>e(this.config))))}))}enableAutoResize(){if(!document||!document.body)throw new Error("Auto-resize can only be enabled when a document (and body) is present");const e=()=>{const e=document.body.getBoundingClientRect();return e.y+e.height},t=new ResizeObserver((()=>{this.setHeight(e())}));return t.observe(document.body),this.setHeight(e()),()=>{t.disconnect()}}getConfig(){return this.config}on(e,t,n){this.eventBus.pushHandler((a=>{a.event===e&&a.field&&a.field.key===t&&n()}))}onConfigUpdate(e){this.configWatchers.push(e)}setHeight(e){this.parent.emit("set-height",e.toString())}setConfig(e){this.parent.emit("save",e)}setSchema(e){this.parent.emit("set-schema",e)}}(async()=>{const e=await(async()=>{const e=new r;return new c(await new o.Model({event(t){e.trigger(t)}}),e)})();let t="";const n=[{key:"contentManagementApiKey",label:"Contentful Manangement API key",type:"short_text",description:'A Contentful Management API key is required to install the "Commerce.js for Contentful" app to your organisations, and configure the app on your selected spaces.'},{key:"environmentName",label:"Environment name",type:"short_text",default:"master",description:'The "environment" to install the app to in Contentful. Currently only one shared environment name is supported across all spaces. You may create multiple integrations if more environments are required.'}],a={key:"selectedSpaces",label:"Contentful spaces to install to",type:"select",options:[],disabled:!0,multiselect:!0,required:!0},i=async t=>{const i=await fetch("https://api.contentful.com/spaces",{mode:"cors",headers:{Authorization:`Bearer ${t}`}});if(200!==i.status)return;const s=(await i.json()).items;e.setSchema([...n,{...a,disabled:!1,options:s.map((e=>({value:`o:${e.sys.organization.sys.id}==s:${e.sys.id}`,label:e.name})))}])},{contentManagementApiKey:s}=e.getConfig();s&&0!==s.length&&i(s),e.setSchema([...n,a]),e.onConfigUpdate((({contentManagementApiKey:s})=>{t!==s&&(t=s,e.setSchema([...n,a]),i(t))}))})();
//# sourceMappingURL=index.189c67c2.js.map
