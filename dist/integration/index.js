(()=>{"use strict";var e={430:function(e){var t=this&&this.__awaiter||function(e,t,n,o){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(o.next(e))}catch(e){i(e)}}function rejected(e){try{step(o["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))};const n="https://contentful-app.chec.io";const handler=(e,o)=>t(void 0,void 0,void 0,(function*(){if(e.body.event!=="integration-ready"){return{statusCode:400,body:"The event that triggered this integration is unsupported."}}const i=yield o.integration();const r=i.config;const s=r.spaceIds.reduce(((e,t)=>{const n=t.match(/^o:([a-zA-Z0-9-_.]{1,64})==s:([a-zA-Z0-9-_.]{1,64})$/);if(!n){return e}const[o,i,r]=n;const s=Object.hasOwnProperty.call(e,i)?e[i]:{};return Object.assign(Object.assign({},e),{[i]:[...s,r]})}),{});const c={};const a=Object.keys(s).map((e=>t(void 0,void 0,void 0,(function*(){const t=`https://api.contentful.com/organizations/${e}/app_definitions`;const i={headers:{Authorization:`Bearer ${r.contentManagementApiKey}`,"Content-Type":"application/vnd.contentful.management.v1+json"}};const{items:s}=yield o.got(t,i).json();const a=s.find((e=>e.src===n));if(a){c[e]=a;return}const p={method:"PUT",responseType:"json",json:{name:"Commerce.js App",src:n,locations:[{location:"app-config"},{location:"entry-field",fieldTypes:[{type:"Symbol"},{type:"Array",items:{type:"Symbol"}}]},{location:"dialog"}]}};const d=yield o.got(t,p);if(d.statusCode!==201){throw new Error(JSON.stringify(d.body))}c[e]=d.body}))));try{yield Promise.all(a)}catch(e){return{statusCode:500,body:`An error occurred creating Contentful app definitions: ${e.message}`}}const p=Object.entries(s).reduce(((e,[n,i])=>e.concat(i.map((e=>t(void 0,void 0,void 0,(function*(){const t=c[n];const i=`https://api.contentful.com/spaces/${e}/environments/${r.environmentName}/app_installations/${t.sys.id}`;const s={method:"PUT",responseType:"json",json:{parameters:{publicKey:o.publicKey}}};const a=yield o.got(i,s);if(a.statusCode!==201){throw new Error(JSON.stringify(a.body))}})))))),[]);yield Promise.all(p);return{statusCode:204,body:""}}));e.exports=handler}};var t={};function __nccwpck_require__(n){var o=t[n];if(o!==undefined){return o.exports}var i=t[n]={exports:{}};var r=true;try{e[n].call(i.exports,i,i.exports,__nccwpck_require__);r=false}finally{if(r)delete t[n]}return i.exports}if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var n=__nccwpck_require__(430);module.exports=n})();