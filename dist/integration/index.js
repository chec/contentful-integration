(()=>{"use strict";var e={430:function(e){var t=this&&this.__awaiter||function(e,t,n,o){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function fulfilled(e){try{step(o.next(e))}catch(e){s(e)}}function rejected(e){try{step(o["throw"](e))}catch(e){s(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))};const n="https://contentful-app.chec.io";const handler=(e,o)=>t(void 0,void 0,void 0,(function*(){if(e.body.event==="integrations.create"){return{statusCode:202,body:""}}if(e.body.event!=="integrations.ready"){return{statusCode:400,body:"The event that triggered this integration is unsupported."}}const s=yield o.integration();const i=s.config;const r=i.selectedSpaces.reduce(((e,t)=>{const n=t.match(/^o:([a-zA-Z0-9-_.]{1,64})==s:([a-zA-Z0-9-_.]{1,64})$/);if(!n){return e}const[o,s,i]=n;const r=Object.hasOwnProperty.call(e,s)?e[s]:[];return Object.assign(Object.assign({},e),{[s]:[...r,i]})}),{});const c={};const a={responseType:"json",headers:{Authorization:`Bearer ${i.contentManagementApiKey}`,"Content-Type":"application/vnd.contentful.management.v1+json"}};const d=Object.keys(r).map((e=>t(void 0,void 0,void 0,(function*(){const t=`https://api.contentful.com/organizations/${e}/app_definitions`;const{items:s}=yield o.got(t,a).json();const i=s.find((e=>e.src.startsWith(n)));if(i){c[e]=i;return}const r={method:"POST",responseType:"json",json:{name:"Commerce.js App",src:n,locations:[{location:"app-config"},{location:"entry-field",fieldTypes:[{type:"Symbol"},{type:"Array",items:{type:"Symbol"}}]},{location:"dialog"}]}};const d=yield o.got(t,r);if(d.statusCode!==201){throw new Error(JSON.stringify(d.body))}c[e]=d.body}))));try{yield Promise.all(d)}catch(e){return{statusCode:500,body:`An error occurred creating Contentful app definitions: ${e.message}`}}const p=Object.entries(r).reduce(((e,[n,s])=>e.concat(s.map((e=>t(void 0,void 0,void 0,(function*(){const t=c[n];const s=`https://api.contentful.com/spaces/${e}/environments/${i.environmentName}/app_installations/${t.sys.id}`;const r=Object.assign(Object.assign({},a),{method:"PUT",json:{parameters:{publicKey:o.publicKey}}});const d=yield o.got(s,r);if(d.statusCode<200||d.statusCode>=300){throw new Error(JSON.stringify(d.body))}})))))),[]);yield Promise.all(p);return{statusCode:200,body:"Successfully installed Commerce.js for Contentful to the configured spaces"}}));e.exports=handler}};var t={};function __nccwpck_require__(n){var o=t[n];if(o!==undefined){return o.exports}var s=t[n]={exports:{}};var i=true;try{e[n].call(s.exports,s,s.exports,__nccwpck_require__);i=false}finally{if(i)delete t[n]}return s.exports}if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var n=__nccwpck_require__(430);module.exports=n})();